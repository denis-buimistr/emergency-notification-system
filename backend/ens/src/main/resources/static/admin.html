<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ENS Admin Panel</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 40px auto; }
        input, button { display: block; margin-top: 10px; padding: 8px; width: 100%; }
        h2 { color: #1e40af; }
        .notif { border: 1px solid #ccc; padding: 10px; margin-top: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <h2>–î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h2>
    <input id="message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
    <input id="type" placeholder="–¢–∏–ø (fire, accident...)">
    <input id="latitude" placeholder="–®–∏—Ä–æ—Ç–∞">
    <input id="longitude" placeholder="–î–æ–ª–≥–æ—Ç–∞">
    <button onclick="createNotification()">–°–æ–∑–¥–∞—Ç—å</button>

    <hr>

    <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
    <div id="notifications"></div>

    <script>
        async function loadNotifications() {
    const res = await fetch('http://localhost:8080/api/notifications');
    const data = await res.json();
    const container = document.getElementById('notifications');
    container.innerHTML = '';
    data.forEach(n => {
        const el = document.createElement('div');
        el.className = 'notif';
        el.innerHTML = `
            <b>${n.type.toUpperCase()}</b>: ${n.message}<br>
            üìç ${n.latitude}, ${n.longitude}<br>
            –°—Ç–∞—Ç—É—Å: <b>${n.status}</b>
            <br><button onclick="resolve(${n.id})">‚úÖ –ü–æ–º–µ—Ç–∏—Ç—å —Ä–µ—à—ë–Ω–Ω—ã–º</button>
        `;
        container.appendChild(el);
    });
}

async function createNotification() {
    const message = document.getElementById('message').value;
    const type = document.getElementById('type').value;
    const latitude = parseFloat(document.getElementById('latitude').value);
    const longitude = parseFloat(document.getElementById('longitude').value);

    try {
        const res = await fetch('http://localhost:8080/api/notifications', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, type, latitude, longitude })
        });

        if (res.ok) {
            alert('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!');
            loadNotifications();
        } else {
            const err = await res.text();
            console.error("–û—à–∏–±–∫–∞:", err);
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏!\n' + err);
        }
    } catch (e) {
        console.error("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å:", e);
        alert('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É!');
    }
}

async function resolve(id) {
    await fetch(`http://localhost:8080/api/notifications/${id}/resolve`, { method: 'PUT' });
    loadNotifications();
}

loadNotifications();

    </script>

</body>
</html>
